- name: Check X server exists
  shell:
    cmd: xset
  changed_when: false

- name: Proceed
  block:

  - name: Ensure the ~/.xinitrc
    lineinfile:
      path: ~/.xinitrc
      create: yes
      mode: "755"
      line: "#!/bin/bash"
      insertbefore: BOF

  - name: Add config to ~/.xinitrc
    loop:
      - touchpad
      - brightness
    include_tasks: "{{ myenv }}/ansible/config/tasks/xorg/{{ item }}.yml"

  - name: Set keyboard layout
    lineinfile:
      path: ~/.xinitrc
      regex: "setxkbmap .*"
      line: "setxkbmap -layout us,ru -option grp:alt_shift_toggle"

  - name: Apply ~/.xinitrc config
    shell:
      cmd: ~/.xinitrc
