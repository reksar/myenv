- name: Check xterm exists
  block:

  - name: Check xterm
    shell:
      cmd: uxterm -v
    register: xterm
    failed_when: false
    changed_when: false

  - name: Set whether xterm exists or not
    set_fact:
      xterm_exists: "{{ xterm.rc == 0 and xterm.stdout != '' }}"

- name: Configure xterm
  when: xterm_exists
  block:

  - name: Link ~/.XTerm
    file:
      src: "{{ myenv }}/linux/home/.XTerm"
      dest: "~/.XTerm"
      state: link
      force: true

  - name: Ensure .Xresources exists
    block:

    - name: Check .Xresources exists
      stat:
        path: ~/.Xresources
      register: xresources

    - name: Create .Xresources
      when: not xresources.stat.exists
      file:
        path: ~/.Xresources
        state: touch
        mode: "644"

  - name: Include .XTerm into .Xresources
    lineinfile:
      path: ~/.Xresources
      line: "#include \".XTerm\""

  - name: Reload X config
    shell:
      cmd: xrdb -load ~/.Xresources
    register: xrdb
    failed_when: xrdb.rc != 0 or xrdb.stderr != ''
